<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekam Medis</title>
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body>
    <!-- side bar -->
    <div class="sidebar">
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="#">
            <div class="sidebar-brand-icon rotate-n-15">
                <img src="../assets/img/logo.png" width="50" height="50"></img>
            </div>
            <div class="sidebar-brand-text">Menu</div>
        </a>
        <hr class="mx-auto" style="max-width: 100%; width: 95%; margin-top: 15px;">
        <ul class="list-unstyled container">
            <li class="side-item">
                <a class="nav-link" href="../index.html">
                    <i class="fas fa-home"></i>
                    <span>Home</span></a>
            </li>
            <li class="side-item">
                <a class="nav-link" href="../pasien/pasien.html">
                    <i class="fas fa-user fa"></i>
                    <span>Pasien</span></a>
            </li>
            <li class="side-item">
                <a class="nav-link" href="../dokter/dokter.html">
                    <i class="fas fa-user fa"></i>
                    <span>Dokter</span></a>
            </li>
            <li class="side-item">
                <a class="nav-link" href="../obat/obat.html">
                    <i class="fas fa-pills fa"></i>
                    <span>Obat</span></a>
            </li>
            <li class="side-item">
                <a class="nav-link" href="../rekamMedis/rekamMedis.html">
                    <i class="fas fa-notes-medical"></i>
                    <span>Rekam Medis</span></a>
            </li>
        </ul>
        <hr class="mx-auto" style="max-width: 100%; width: 95%; margin-top: 15px;">
    </div>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
        </div>
    </nav>

    <!-- Main Content -->
    <div class="content">
        <div class="container-fluid">
            <div style="display: flex;">
                <div>
                    <h2>Dashboard Rekam Medis Pasien</h2>
                    <p class="subtitle">Electronic Medical Record</p>
                </div>
            </div>
            <div class="container mt-5 text-center">
                <!-- Button untuk membuka modal -->
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#rekamMedisModal">
                    Buka Form Data Rekam Medis
                </button>
            </div>

            <div class="modal fade" id="rekamMedisModal" tabindex="-1" aria-labelledby="rekamMedisModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="rekamMedisModalLabel">Form Data Rekam Medis Pasien</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <!-- Form Rekam Medis -->
                            <form id="rekamMedisForm">
                                <div class="form-group">
                                    <label for="id_pasien">ID Pasien:</label>
                                    <select class="form-control" id="id_pasien" name="id_pasien" required>
                                        <!-- Data ID Pasien akan dimuat di sini -->
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="id_dokter">ID Dokter:</label>
                                    <select class="form-control" id="id_dokter" name="id_dokter" required>
                                        <!-- Data ID Dokter akan dimuat di sini -->
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="diagnosis">Diagnosis:</label>
                                    <textarea class="form-control" id="diagnosis" name="diagnosis" rows="3"
                                        required></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="pengobatan">Pengobatan:</label>
                                    <textarea class="form-control" id="pengobatan" name="pengobatan" rows="3"
                                        required></textarea>
                                </div>



                                <button type="button" class="btn btn-primary"
                                    onclick="submitRekamMedis()">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <hr>

            <h4 class="text-center">Data Rekam Medis Pasien</h4>
            <p class="text-center">Rekam medis berisi data klinis pasien selama proses diagnosis dan pengobatan
                (treatment). Rekam medis merupakan bukti tertulis tentang proses pelayanan yang diberikan oleh dokter.
                Setiap dokter diharapkan mengisi rekam medis dengan benar, lengkap, dan tepat waktu untuk setiap
                kegiatan pelayanan medis yang dilakukan.</p>
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>ID Pasien</th>
                        <th>ID Dokter</th>
                        <th>Diagnosis</th>
                        <th>Pengobatan</th>
                        <th>Diterbitkan</th>
                    </tr>
                </thead>
                <tbody id="rekamMedisData">
                    <!-- Data Rekam Medis akan dimuat disini -->
                </tbody>
            </table>
        </div>
        <!-- Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script>

            // Ambil data pasien dan dokter menggunakan AJAX
            $(document).ready(function () {
                $.ajax({
                    url: './getDatas.php',
                    method: 'GET',
                    dataType: 'json',  // Pastikan data yang diterima adalah JSON
                    success: function (data) {
                        // Pastikan data yang diterima benar
                        console.log(data); // Lihat output di console

                        // Mengisi dropdown Pasien
                        const pasienSelect = $('#id_pasien');
                        pasienSelect.empty(); // Kosongkan dropdown sebelum mengisinya
                        data.pasienData.forEach(function (pasien) {
                            pasienSelect.append('<option value="' + pasien.id_pasien + '">' + pasien.nama + '</option>');
                        });

                        // Mengisi dropdown Dokter
                        const dokterSelect = $('#id_dokter');
                        dokterSelect.empty(); // Kosongkan dropdown sebelum mengisinya
                        data.dokterData.forEach(function (dokter) {
                            dokterSelect.append('<option value="' + dokter.id_dokter + '">' + dokter.nama_dokter + '</option>');
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error('Error:', error);
                    }
                });
            });



            function submitRekamMedis() {
                const formData = new FormData(document.getElementById('rekamMedisForm'));

                // Ambil data form dan ubah menjadi objek JSON
                const data = {
                    id_pasien: formData.get('id_pasien'),
                    id_dokter: formData.get('id_dokter'),
                    diagnosis: formData.get('diagnosis'),
                    pengobatan: formData.get('pengobatan')
                };

                // Kirim data ke PHP dengan fetch menggunakan POST
                fetch('./rekamMedis.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data) // Kirim data dalam format JSON
                })
                    .then(response => response.text())
                    .then(message => {
                        alert("Data berhasil ditambahkan"); // Tampilkan pesan sukses atau error dari PHP
                        document.getElementById('rekamMedisForm').reset(); // Reset form setelah submit
                        location.reload(); // Muat ulang halaman untuk melihat data terbaru
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            }


            function displayRekamMedisData(data) {
                console.log("Data yang diterima:", data); // Tambahkan log di sini

                const tableBody = document.getElementById('rekamMedisData');
                tableBody.innerHTML = ''; // Bersihkan tabel sebelum menambah data baru

                // Menambahkan data rekam medis ke tabel
                data.forEach((rekamMedis, index) => {
                    const row = document.createElement('tr');

                    // Menambahkan kolom ke tabel
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${rekamMedis.nama_pasien}</td>
                        <td>${rekamMedis.nama_dokter}</td>
                        <td>${rekamMedis.diagnosis}</td>
                        <td>${rekamMedis.pengobatan}</td>
                        <td>${rekamMedis.tanggal_kunjungan}</td>
                    `;

                    tableBody.appendChild(row);
                });
            }

            // Panggil fungsi untuk menampilkan data rekam medis ketika halaman dimuat
            window.onload = function () {
                fetch('./rekamMedis.php', {
                    method: 'GET'
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log("Data fetched:", data); // Tambahkan log di sini
                        displayRekamMedisData(data);  // Tampilkan data rekam medis yang ada saat halaman dimuat
                    })
                    .catch(error => console.error('Error fetching data:', error));
            }




        </script>


    </div>
</body>

</html>